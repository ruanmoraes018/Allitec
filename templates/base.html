<!doctype html>
{% load static %}
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.14.1/themes/base/jquery-ui.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    <link rel="shortcut icon" href="{% static 'img/favicon.ico' %}" type="image/x-icon">
    <meta name="facebook-domain-verification" content="r2z7obkhjoyogff2u0usb7gmzudsif" />
    <title>{% block title %}{% endblock %}</title>
</head>
<body>
    <style>
        @keyframes pulse-fade {
          0% {
            opacity: 1;
            transform: scale(1);
          }
          50% {
            opacity: 0.4;
            transform: scale(1.1);
          }
          100% {
            opacity: 1;
            transform: scale(1);
          }
        }

        .badge-pulse {
          animation: pulse-fade 1.5s infinite ease-in-out;
        }
    </style>
    <div class="container-fluid">
        {% if user.is_authenticated %}
            <nav class="navbar fixed-top navbar-expand-lg bg-body-tertiary">
                <div class="container-fluid">
                    <!-- Menu e Nome -->
                    <div class="d-flex align-items-center">
                        <i class="navbar-brand fa-solid fa-bars"
                           style="margin-left: 20px; font-size: 20px;"
                           data-bs-toggle="offcanvas"
                           href="#offcanvasExample"
                           role="button"
                           aria-controls="offcanvasExample"></i>

                        {% if request.user.is_superuser %}
                            <a class="navbar-brand ms-1" href="{% url 'lista-empresas' %}" style="text-decoration: none;">
                                <div class="text-uppercase" style="font-size: 1.5rem; font-weight: bold;">
                                    ADMINISTRAÇÃO
                                </div>
                            </a>
                        {% else %}
                            <a class="navbar-brand ms-1" href="{% url 'inicio' %}" style="text-decoration: none;">
                                <div class="text-uppercase" style="font-size: 1.5rem; font-weight: bold;">
                                    {{ request.user.filial_user.fantasia }}
                                </div>
                            </a>
                        {% endif %}
                    </div>

                    <!-- Notificações e Logout alinhados à direita -->
                    <div class="d-flex align-items-center ms-auto" style="font-size: 20px; margin-right: 10px;">
                        <!-- Ícone de Notificação -->
                        <div class="nav-item dropdown">
                            <a class="nav-link" href="#" id="notificationsDropdown" role="button"
                               data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="fas fa-bell"></i>
                                {% if notificacoes %}
                                    <span class="position-absolute top-0 start-100 translate-middle badge border border-light rounded-circle bg-danger p-2 badge-pulse">
                                      <span class="visually-hidden">Notificações não lidas</span>
                                    </span>

                                {% endif %}
                            </a>
                            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="notificationsDropdown" style="width: 300px;">
                                {% for notificacao in notificacoes %}
                                    <li>
                                        <a href="#"
                                           class="abrir-modal-solicitacao dropdown-item text-wrap"
                                           data-id="{{ notificacao.data.solicitacao_id|default_if_none:'' }}"
                                           data-verb="{{ notificacao.verb|default_if_none:'' }}"
                                           data-description="{{ notificacao.description|default_if_none:'' }}">
                                            {{ notificacao.verb }}
                                            <br>
                                            <small class="text-muted text-wrap">Mais informações, clique aqui!</small>
                                        </a>
                                    </li>
                                {% empty %}
                                    <li>
                                        <a href="#" class="dropdown-item disabled text-center">Nenhuma notificação</a>
                                    </li>
                                {% endfor %}
                            </ul>
                        </div>
                        <div class="modal fade" id="modalSolicitacao" tabindex="-1" aria-labelledby="modalSolicitacaoLabel" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="modalSolicitacaoLabel">Solicitação de Permissão</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
                                    </div>
                                    <div class="modal-body">
                                        <p id="descricaoSolicitacao"></p>
                                        <input type="hidden" id="solicitacaoId" name="id" value="">

                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-danger" id="negarSolicitacao">Negar</button>
                                        <button type="button" class="btn btn-success" id="aprovarSolicitacao">Aprovar</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {% if request.user.is_superuser %}
                            <!-- Ícone de Logout Superuser -->
                            <div class="nav-item ms-3">
                                <a class="nav-link" href="{% url 'logout-view-superuser' %}" title="Sair"
                                   onclick="showLoadingModal()">
                                    <i class="fa-solid fa-right-from-bracket"></i>
                                </a>
                            </div>
                        {% else %}
                            <!-- Ícone de Logout -->
                            <div class="nav-item ms-3">
                                <a class="nav-link" href="{% url 'logout-view' %}" title="Sair"
                                   onclick="showLoadingModal()">
                                    <i class="fa-solid fa-right-from-bracket"></i>
                                </a>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </nav>
        {% endif %}
        <div class="offcanvas offcanvas-start bg-dark text-white" tabindex="-1" id="offcanvasExample" aria-labelledby="offcanvasExampleLabel">
            <div class="offcanvas-header">
                <div>
                    <h5 class="offcanvas-title mb-0" id="offcanvasExampleLabel">Menu de Opções</h5>
                    <small>Usuário: {{ request.user.first_name }}</small>
                </div>
                <div data-bs-theme="dark">
                    <button type="button" class="btn-close" style="color: white;" data-bs-dismiss="offcanvas" aria-label="Close"></button>
                </div>
            </div>
            <div class="offcanvas-body">
                <div class="offcanvas-body">
                    <div class="d-flex flex-column gap-2">
                        {% if not request.user.is_superuser %}
                            {% if perm_view_tabelapreco or perm_view_marcas or perm_view_formapgto or perm_view_tipocobranca or perm_view_unidades or perm_view_bancos or perm_view_grupos or perm_view_bairros or perm_view_cidades or perm_view_estados %}
                                <a class="btn btn-dark w-100 text-start" data-bs-toggle="collapse" href="#guiaComplementos" role="button" aria-expanded="false" aria-controls="guiaComplementos">
                                    <i class="fa-solid fa-table"></i> Complementos
                                </a>
                                <div class="collapse" id="guiaComplementos">
                                    <div class="p-2">
                                        {% if perm_view_bairros %}
                                            <a href="{% url 'lista-bairros' %}" class="btn btn-dark w-100 mb-1 lista-funcao">Bairros</a>
                                        {% endif %}
                                        {% if perm_view_cidades %}
                                            <a href="{% url 'lista-cidades' %}" class="btn btn-dark w-100 mb-1 lista-funcao">Cidades</a>
                                        {% endif %}
                                        {% if perm_view_estados %}
                                            <a href="{% url 'lista-estados' %}" class="btn btn-dark w-100 mb-1 lista-funcao">Estados</a>
                                        {% endif %}
                                        {% if perm_view_marcas %}
                                            <a href="{% url 'lista-marcas' %}" class="btn btn-dark w-100 mb-1 lista-funcao">Marcas</a>
                                        {% endif %}
                                        {% if perm_view_grupos %}
                                            <a href="{% url 'lista-grupos' %}" class="btn btn-dark w-100 mb-1 lista-funcao">Grupos</a>
                                        {% endif %}
                                        {% if perm_view_unidades %}
                                            <a href="{% url 'lista-unidades' %}" class="btn btn-dark w-100 mb-1 lista-funcao">Unidades</a>
                                        {% endif %}
                                        {% if perm_view_bancos %}
                                            <a href="{% url 'lista-bancos' %}" class="btn btn-dark w-100 mb-1 lista-funcao">Bancos</a>
                                        {% endif %}
                                        {% if perm_view_tipocobranca %}
                                            <a href="{% url 'lista-tp_cobrancas' %}" class="btn btn-dark w-100 mb-1 lista-funcao">Tipos de Cobrança</a>
                                        {% endif %}
                                        {% if perm_view_formapgto %}
                                            <a href="{% url 'lista-formas_pgto' %}" class="btn btn-dark w-100 mb-1 lista-funcao">Formas de Pagamento</a>
                                        {% endif %}
                                        {% if perm_view_tabelapreco %}
                                            <a href="{% url 'lista-tabelas_preco' %}" class="btn btn-dark w-100 mb-1 lista-funcao">Tabelas de Preço</a>
                                        {% endif %}
                                        {% if perm_view_regraproduto %}
                                            <a href="{% url 'lista-regras' %}" class="btn btn-dark w-100 mb-1 lista-funcao">Regras de Produto</a>
                                        {% endif %}
                                    </div>
                                </div>
                            {% endif %}
                        {% endif %}
                        {% if request.user.is_superuser %}
                            <a class="btn btn-dark w-100 text-start" data-bs-toggle="collapse" href="#guiaCadastros" role="button" aria-expanded="false" aria-controls="guiaCadastros">
                                <i class="fa-solid fa-box-archive"></i> Cadastros
                            </a>
                            <div class="collapse" id="guiaCadastros">
                                <div class="p-2">
                                    <a href="{% url 'lista-empresas' %}" class="btn btn-dark w-100 mb-1 lista-funcao">Empresas</a>
                                </div>
                            </div>
                        {% elif perm_view_filial or perm_view_usuario or perm_view_produtos or perm_view_clientes or perm_view_tecnicos or perm_view_fornecedores %}
                            <a class="btn btn-dark w-100 text-start" data-bs-toggle="collapse" href="#guiaCadastros" role="button" aria-expanded="false" aria-controls="guiaCadastros">
                                <i class="fa-solid fa-box-archive"></i> Cadastros
                            </a>
                            <div class="collapse" id="guiaCadastros">
                                <div class="p-2">
                                    {% if perm_view_filial %}
                                        <a href="{% url 'lista-filiais' %}" class="btn btn-dark w-100 mb-1 lista-funcao">Filiais</a>
                                    {% endif %}
                                    {% if perm_view_usuario %}
                                        <a href="{% url 'lista-usuarios' %}" class="btn btn-dark w-100 mb-1 lista-funcao">Usuários</a>
                                    {% endif %}
                                    {% if perm_view_produtos %}
                                        <a href="{% url 'lista-produtos' %}" class="btn btn-dark w-100 mb-1 lista-funcao">Produtos</a>
                                    {% endif %}
                                    {% if perm_view_clientes %}
                                        <a href="{% url 'lista-clientes' %}" class="btn btn-dark w-100 mb-1 lista-funcao">Clientes</a>
                                    {% endif %}
                                    {% if perm_view_fornecedores %}
                                        <a href="{% url 'lista-fornecedores' %}" class="btn btn-dark w-100 mb-1 lista-funcao">Fornecedores</a>
                                    {% endif %}
                                    {% if perm_view_tecnicos %}
                                        <a href="{% url 'lista-tecnicos' %}" class="btn btn-dark w-100 mb-1 lista-funcao">Técnicos</a>
                                    {% endif %}
                                </div>
                            </div>
                        {% endif %}
                        {% if not request.user.is_superuser %}
                            {% if perm_view_entradas %}
                                <a class="btn btn-dark w-100 text-start" data-bs-toggle="collapse" href="#guiaEstoque" role="button" aria-expanded="false" aria-controls="guiaEstoque">
                                    <i class="fa-solid fa-box-open"></i> Estoque
                                </a>
                                <div class="collapse" id="guiaEstoque">
                                    <div class="p-2">
                                        {% if perm_view_entradas %}
                                            <a href="{% url 'lista-entradas' %}" class="btn btn-dark w-100 mb-1 lista-funcao">Entrada de NF/Pedidos</a>
                                        {% endif %}
                                    </div>
                                </div>
                            {% endif %}
                        {% endif %}
                        {% if request.user.is_superuser %}
                            <a class="btn btn-dark w-100 text-start" data-bs-toggle="collapse" href="#guiaFaturamentos" role="button" aria-expanded="false" aria-controls="guiaFaturamentos">
                                <i class="fa-solid fa-calculator"></i> Faturamento
                            </a>
                            <div class="collapse" id="guiaFaturamentos">
                                <div class="p-2">
                                    {% if perm_view_contrato %}
                                        <a href="{% url 'lista-contratos' %}" class="btn btn-dark w-100 lista-funcao">Contratos</a>
                                    {% endif %}
                                </div>
                            </div>
                        {% elif perm_view_orcamentos or perm_view_pedidos %}
                            <a class="btn btn-dark w-100 text-start" data-bs-toggle="collapse" href="#guiaFaturamentos" role="button" aria-expanded="false" aria-controls="guiaFaturamentos">
                                <i class="fa-solid fa-calculator"></i> Faturamento
                            </a>
                            <div class="collapse" id="guiaFaturamentos">
                                <div class="p-2">
                                    {% if perm_view_orcamentos or perm_view_pedidos %}
                                        <a href="{% url 'lista-pedidos' %}" class="btn btn-dark w-100 lista-funcao">Pedidos</a>
                                        <a href="{% url 'lista-orcamentos' %}" class="btn btn-dark w-100 lista-funcao">Orçamentos - Portas</a>
                                    {% endif %}
                                </div>
                            </div>
                        {% endif %}
                        {% if request.user.is_superuser %}
                            <a class="btn btn-dark w-100 text-start" data-bs-toggle="collapse" href="#guiaFinanceiro" role="button" aria-expanded="false" aria-controls="guiaFinanceiro">
                                <i class="fa-solid fa-building-columns"></i> Financeiro
                            </a>
                            <div class="collapse" id="guiaFinanceiro">
                                <div class="p-2">
                                    <a href="{% url 'lista-mensalidades' %}" class="btn btn-dark w-100 mb-1 lista-funcao">Mensalidades</a>
                                </div>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        <div class="modal fade" id="loadingModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal border-0 d-flex align-items-center">
                    <div class="modal-body text-center">
                        <div class="spinner-border text-dark spinner-lg" role="status" style="width: 3rem; height: 3rem;">
                            <span class="visually-hidden">Carregando...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% block content %}{% endblock %}
    <script>
        function showLoadingModal() {
            const modal = new bootstrap.Modal(document.getElementById('loadingModal'));
            modal.show();
            setTimeout(() => {
                window.location.href = "{% url 'logout-view' %}";
            }, 800); // tempo para mostrar o spinner antes de sair
            return false; // impede o link de navegar automaticamente
        }

    </script>

    <!-- Carregue apenas UMA versão do jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script src="https://code.jquery.com/ui/1.14.1/jquery-ui.js"></script>

    <!-- Tradução para português -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/pt.js"></script>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Outros scripts -->
    <script src="https://kit.fontawesome.com/fdc1a494f5.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <!-- jQuery Mask -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js" integrity="sha512-pHVGpX7F/27yZ0ISY+VVjyULApbDlD0/X0rgGbTqCE7WFW5MezNTWG/dnhtbBuICzsd0WQPgpE4REBLv+UqChw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <!-- Scripts personalizados -->
    <script src="{% static 'js/scripts.js' %}"></script>

</body>
</html>
{% extends 'base.html' %}
{% load static %}
{% load custom_filters %}
{% block title %}Allitec - Dashboard{% endblock %}
{% block content %}
    {% block nav %}
        {% if messages %}
            <div id="django-messages" data-messages='[
                {% for message in messages %}
                    {"text": "{{ message|escapejs }}", "tag": "{{ message.tags }}"}
                    {% if not forloop.last %},{% endif %}
                {% endfor %}
            ]'></div>
        {% endif %}
        <div class="container-fluid bg-white">
            <h1 class="text-center" style="font-size: 30px;">Dashboard</h1>
            <div class="row">
                <div class="col-sm-6 mb-3 mb-sm-3" style="margin-bottom: 10px;">
                    <div class="card">
                        <div class="card-header bg-secondary-subtle">
                            <h5 class="card-title text-info-emphasis text-center">Resumo de Orçamentos <i class="fa-solid fa-calendar-days"></i> {{ primeiro_dia_mes|date:"d" }} - {{ ultimo_dia_mes|date:"d F Y"|upper }}</h5>
                        </div>
                        <div class="card-body">
                            <div class="row g-3">
                                <div class="d-flex flex-column gap-2">
                                    {% if orcamentos_abertos > 0 %}
                                    <div class="d-flex align-items-center justify-content-between p-2 border rounded">
                                        <span class="badge bg-primary fs-6 px-3 py-2">
                                            <i class="fa-solid fa-folder-open me-1"></i>
                                            {{ orcamentos_abertos }}
                                            {% if orcamentos_abertos > 1 %} Abertos {% else %} Aberto {% endif %}
                                        </span>
                                        <span class="fw-bold text-primary">
                                            R$ {{ total_abertos|moeda_br }}
                                        </span>
                                    </div>
                                    {% endif %}
                                    {% if orcamentos_faturados > 0 %}
                                    <div class="d-flex flex-column p-2 border rounded bg-light">
                                        <div class="d-flex align-items-center justify-content-between">
                                            <span class="badge bg-success fs-6 px-3 py-2">
                                                <i class="fa-solid fa-circle-check me-1"></i> 
                                                {{ orcamentos_faturados }}
                                                {% if orcamentos_faturados > 1 %} Faturados {% else %} Faturado {% endif %}
                                            </span>
                                            <span class="fw-bold text-success">
                                                R$ {{ total_faturados|moeda_br }}
                                            </span>
                                        </div>
                                        <small class="text-muted mt-1">
                                            Média por orçamento: <strong>{{ media_valor_fat|moeda_br }}</strong>
                                        </small>
                                    </div>
                                    {% endif %}
                                    {% if orcamentos_cancelados > 0 %}
                                    <div class="d-flex align-items-center justify-content-between p-2 border rounded">
                                        <span class="badge bg-danger fs-6 px-3 py-2">
                                            <i class="fa-solid fa-ban me-1"></i>
                                            {{ orcamentos_cancelados }}
                                            {% if orcamentos_cancelados > 1 %} Cancelados {% else %} Cancelado {% endif %}
                                        </span>
                                        <span class="fw-bold text-danger">
                                            {{ total_cancelados|moeda_br }}
                                        </span>
                                    </div>
                                    {% endif %}
                                    {% if orcamentos_abertos < 1 and orcamentos_faturados < 1 and orcamentos_cancelados < 1 %}
                                        <div class="text-center">
                                            Não há orçamentos gerados!
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-sm-6" style="margin-bottom: 10px;">
                    <div class="card">
                        <div class="card-header bg-secondary-subtle">
                            <h5 class="card-title text-info-emphasis text-center">Orçamentos por Técnico <i class="fa-solid fa-calendar-days"></i> {{ primeiro_dia_mes|date:"d" }} - {{ ultimo_dia_mes|date:"d F Y"|upper }}</h5>
                        </div>
                        <div class="card-body">
                            <div class="d-flex flex-column gap-2">
                                {% for tecnico in tecnicos %}
                                <div class="d-flex align-items-center justify-content-between p-2 border rounded">
                                    <div class="d-flex align-items-center gap-2">
                                        <strong>{{ tecnico.nome }}</strong>
                                        <span class="badge bg-secondary">
                                            {{ tecnico.qtd }}
                                            {% if tecnico.qtd > 1 %} orçamentos {% else %} orçamento {% endif %}
                                        </span>
                                    </div>
                                    <span class="fw-bold text-success">
                                        {{ tecnico.total|moeda_br }}
                                    </span>
                                </div>
                                {% empty %}
                                <div class="text-center text-muted py-3">
                                    <i class="fa-solid fa-circle-info me-1"></i>
                                    Não há orçamentos faturados!
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    {% endblock %}
{% endblock %}

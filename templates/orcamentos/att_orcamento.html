{% extends 'base.html' %}
{% load static %}
{% load custom_filters %}
{% load crispy_forms_tags %}
{% block title %}Alterar Or√ßamento{% endblock %}
{% block content %}
<div class="container-fluid bg-white">
    <nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'inicio' %}" id="item-naveg">Principal</a></li>
            <li class="breadcrumb-item"><a href="{% url 'lista-orcamentos' %}" id="item-naveg">Or√ßamentos</a></li>
            <li class="breadcrumb-item active" aria-current="page">Alterar</li>
        </ol>
    </nav>
    <div class="formularios">
        <form method="POST" id="createForm" class="orcamentoForm" enctype="multipart/form-data">
            {% csrf_token %}
            {% if orcamento %}
                {% if error_messages %}
                    <div id="toast-messages" data-messages='[
                        {"text": "{% for message in error_messages %}{{ message }}<br>{% endfor %}", "tag": "error"}
                    ]'></div>
                {% endif %}
                <div class="card">
                    <div class="card-header">
                        <span>
                            ALTERA√á√ÉO DE OR√áAMENTOS
                        </span>
                    </div>
                    <div class="form-buttons" style="margin-left: 10px; margin-top: 10px;">
                        <button type="button" class="btn btn-dark" id="medidasBtn">Medidas</button>
                        <button type="button" class="btn btn-dark" id="clienteBtn">Cliente</button>
                        <button type="button" class="btn btn-dark" id="prod_servBtn">Produtos</button>
                        <button type="button" class="btn btn-dark" id="adicionaisBtn">Adicionais</button>
                        <button type="button" class="btn btn-dark" id="form_pgtoBtn">Form. Pgto.</button>
                    </div>
                    <div class="card-body">
                        <!--Cliente-->
                        <div class="form-section" id="clientes">
                            <div class="row" style="margin-left: -8px;">
                                <div class="col-md-1">
                                    {{ form.num_orcamento|as_crispy_field }}
                                </div>
                                <div class="col-md-3">
                                    {{ form.vinc_fil|as_crispy_field }}
                                </div>
                                <div class="col-md-3">
                                    {{ form.solicitante|as_crispy_field }}
                                </div>
                                <div class="col-md-1">
                                    {{ form.dt_emi|as_crispy_field }}
                                </div>
                                <div class="col-md-1">
                                    {{ form.dt_ent|as_crispy_field }}
                                </div>
                            </div>
                            <hr>
                            <div class="row" style="margin-left: -8px;">
                                <div class="col-md-3">
                                    {{ form.cli|as_crispy_field }}
                                </div>
                                <div class="col-md-2" id="div_id_cpfCnpj">
                                    <label for="id_cpfCnpj" class="form-label requiredField">CPF/CNPJ</label>
                                    <input type="text" class="form-control form-control-sm border-dark-subtle" id="id_cpfCnpj" name="cpfCnpj" disabled="disabled">
                                </div>
                                <div class="col-md-3" id="div_id_email">
                                    <label for="id_email" class="form-label requiredField">E-mail</label>
                                    <input type="text" class="form-control form-control-sm border-dark-subtle text-uppercase" id="id_email" name="email" disabled="disabled">
                                </div>
                                <div class="col-md-2" id="div_id_tel">
                                    <label for="id_tel" class="form-label requiredField">Fone</label>
                                    <input type="text" class="form-control form-control-sm border-dark-subtle text-uppercase" id="id_tel" name="tel" disabled="disabled">
                                </div>
                                <div class="col-md-2" id="div_id_cep">
                                    <label for="id_cep" class="form-label requiredField">CEP*</label>
                                    <input type="text" class="form-control form-control-sm border-dark-subtle text-uppercase" id="id_cep" name="cep" disabled="disabled">
                                </div>
                                <div class="col-md-4" id="div_id_endereco">
                                    <label for="id_endereco" class="form-label requiredField">Endere√ßo*</label>
                                    <input type="text" class="form-control form-control-sm border-dark-subtle text-uppercase" id="id_endereco" name="endereco" disabled="disabled">
                                </div>
                                <div class="col-md-1" id="div_id_numero">
                                    <label for="id_numero" class="form-label requiredField">N¬∫*</label>
                                    <input type="text" class="form-control form-control-sm border-dark-subtle text-uppercase" id="id_numero" name="numero" disabled="disabled">
                                </div>
                                <div class="col-md-3" id="div_id_bairro">
                                    <label for="id_bairro_txt" class="form-label requiredField">Bairro*</label>
                                    <input type="text" class="form-control form-control-sm border-dark-subtle text-uppercase" id="id_bairro_txt" name="bairro" disabled="disabled">
                                </div>
                                <div class="col-md-2" id="div_id_cidade">
                                    <label for="id_cidade_txt" class="form-label">Cidade*</label>
                                    <input type="text" class="form-control form-control-sm border-dark-subtle text-uppercase" id="id_cidade_txt" name="cidade" disabled="disabled">
                                </div>
                                <div class="col-md-2" id="div_id_uf">
                                    <label for="id_uf_txt" class="form-label requiredField">Estado*</label>
                                    <input type="text" class="form-control form-control-sm border-dark-subtle text-uppercase" id="id_uf_txt" name="uf" disabled="disabled">
                                </div>
                                <div class="col-md-12">
                                    {{ form.obs_cli|as_crispy_field }}
                                </div>
                            </div>
                        </div>
                        <!--Medidas-->
                        <div class="form-section" id="medidas">
                            <div class="row" style="margin-left: -8px;">
                                <div class="row g-2 align-items-end">
                                    <div class="col-md-2">
                                        <label for="qtd_portas" class="form-label">N¬∫ de Portas:</label>
                                        <input type="number" id="qtd_portas" class="form-control form-control-sm" min="1" value="1">
                                    </div>
                                    <div class="col-md-2">
                                        <button type="button" id="btnGerarPortas" class="btn btn-dark btn-sm"><i class="fa-solid fa-square-plus"></i> Gerar</button>
                                    </div>
                                    <div class="col-md-8">
                                        <small class="text-muted">Ap√≥s gerar, preencha largura/altura e abra Produtos / Adicionais para visualizar os itens por porta.</small>
                                    </div>
                                </div>
                                <!-- TABELA RESUMO (linhas das portas geradas) -->
                                <div class="card mb-3" style="margin: 0; margin-top: 10px; padding-left: 0; padding-right: 0;">
                                    <div class="card-header text-center"><i class="fa-solid fa-align-justify"></i> <strong>Portas Geradas</strong></div>
                                    <div class="card-body p-1">
                                        <table class="table table-bordered table-sm table-striped mb-0" id="tabelaPortasResumo">
                                            <thead class="table-dark">
                                                <tr>
                                                    <th>#</th>
                                                    <th style="width: 6%;">Largura</th>
                                                    <th style="width: 6%;">Altura</th>
                                                    <th style="width: 6%;">Lg. Corte</th>
                                                    <th style="width: 6%;">At. Corte</th>
                                                    <th style="width: 6%;">Qtd. L√¢m</th>
                                                    <th style="width: 6%;">M¬≤</th>
                                                    <th style="width: 6%;">Ft. Peso</th>
                                                    <th style="width: 6%;">Peso</th>
                                                    <th style="width: 6.5%;">Eixo Motor</th>
                                                    <th style="width: 6%;">Rolo</th>
                                                    <th>Tipo de L√¢mina</th>
                                                    <th>Tipo de V√£o</th>
                                                    <th style="width: 40px;">Exc.</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% for pt in orcamento.portas.all %}
                                                    <tr id="linha_resumo_{{ pt.numero }}" class="linha-porta" data-porta="{{ pt.numero }}">
                                                        <td data-label="Porta:" class="mobile-3col">{{ forloop.counter|stringformat:"01d" }}</td>
                                                        <td data-label="Larg.:" class="mobile-3col"><input type="text" class="form-control form-control-sm larg" data-porta="{{ pt.numero }}" placeholder="0.00" value="{{ pt.largura }}"></td>
                                                        <td data-label="Alt.:" class="mobile-3col"><input type="text" class="form-control form-control-sm alt" data-porta="{{ pt.numero }}" placeholder="0.00" value="{{ pt.altura }}"></td>
                                                        <td data-label="Lg. Corte:" class="mobile-3col"><input readonly class="form-control form-control-sm larg-corte" data-porta="{{ pt.numero }}" placeholder="0.00" value="{{ pt.larg_corte }}"></td>
                                                        <td data-label="At. Corte:" class="mobile-3col"><input readonly class="form-control form-control-sm alt-corte" data-porta="{{ pt.numero }}" placeholder="0.00" value="{{ pt.alt_corte }}"></td>
                                                        <td data-label="Qtd. L√¢m.:" class="mobile-3col"><input readonly class="form-control form-control-sm qtd-laminas" data-porta="{{ pt.numero }}" placeholder="0.00" value="{{ pt.qtd_lam }}"></td>
                                                        <td data-label="M¬≤:" class="mobile-3col"><input readonly class="form-control form-control-sm m2" data-porta="{{ pt.numero }}" placeholder="0.00" value="{{ pt.m2 }}"></td>
                                                        <td data-label="Ft. Peso:" class="mobile-3col"><input readonly class="form-control form-control-sm ft-peso" data-porta="{{ pt.numero }}" placeholder="0.00" value="{{ pt.fator_peso }}"></td>
                                                        <td data-label="Peso:" class="mobile-3col"><input readonly class="form-control form-control-sm peso" data-porta="{{ pt.numero }}" placeholder="0.00" value="{{ pt.peso }}"></td>
                                                        <td data-label="Eix. Mot.:" class="mobile-3col"><input readonly class="form-control form-control-sm eix-mot" data-porta="{{ pt.numero }}" placeholder="0.00" value="{{ pt.eixo_motor }}"></td>
                                                        {% load l10n %}
                                                        <td data-label="Rolo:" class="mobile-3col">
                                                            <input readonly class="form-control form-control-sm rolo" data-porta="{{ pt.numero }}" placeholder="0.00" value="{{ pt.rolo|unlocalize }}">
                                                        </td>
                                                        <td data-label="Tp. L√¢m.:" class="mobile-3col">
                                                            <select class="form-select form-select-sm tipo-lamina" data-porta="{{ pt.numero }}">
                                                                <option value="Fechada" {% if pt.tipo_lamina == "Fechada" %}selected{% endif %}>Fechada</option>
                                                                <option value="Transvision" {% if pt.tipo_lamina == "Transvision" %}selected{% endif %}>Transvision</option>
                                                            </select>
                                                        </td>
                                                        <td data-label="Tp. V√£o:" class="mobile-2col">
                                                            <select class="form-select form-select-sm tipo-vao" data-porta="{{ pt.numero }}">
                                                                <option value="Fora do V√£o" {% if pt.tipo_vao == "Fora do V√£o" %}selected{% endif %}>Fora do V√£o</option>
                                                                <option value="Dentro do V√£o" {% if pt.tipo_vao == "Dentro do V√£o" %}selected{% endif %}>Dentro do V√£o</option>
                                                                <option value="1 Lado Dentro do V√£o" {% if pt.tipo_vao == "1 Lado Dentro do V√£o" %}selected{% endif %}>1 Lado Dentro do V√£o</option>
                                                            </select>
                                                        </td>
                                                        <td data-label="Exc.:" class="text-center mobile-2col">
                                                            <button type="button" class="btn btn-danger btn-sm removerPorta" data-porta="{{ pt.numero }}">
                                                                <i class="fa-solid fa-trash-can"></i>
                                                            </button>
                                                        </td>
                                                    </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>  
                                </div>
                                <div class="col-md-1">
                                    {{ form.pintura|as_crispy_field }}
                                </div>
                                <div class="col-md-2">
                                    {{ form.tp_pintura|as_crispy_field }}
                                </div>
                                <div class="col-md-2">
                                    {{ form.cor|as_crispy_field }}
                                </div>
                                <div class="col-md-2">
                                    {{ form.portao_social|as_crispy_field }}
                                </div>
                                <div class="col-md-1">
                                    {{ form.vl_p_s|as_crispy_field }}
                                </div>
                                <input type="hidden" id="id_json_portas" name="json_portas">
                            </div>
                        </div>
                        <!--Prod./Servi√ßos-->
                        <div class="form-section" id="prod_serv">
                            <div class="row" style="margin-left: -8px;">
                                <!-- Accordion Produtos -->
                                <div class="accordion" id="accordionProdutos">
                                    {% for pt in portas %}
                                        <div class="accordion-item acc-produto porta-{{ pt.numero }}" id="accProd_{{ pt.numero }}" data-porta="{{ pt.numero }}">
                                            <h2 class="accordion-header" id="headingProd_{{ pt.numero }}">
                                                <button class="accordion-button collapsed fw-bold" type="button" data-bs-toggle="collapse" data-bs-target="#collapseProd_{{ pt.numero }}">
                                                    Produtos ‚Äì Porta {{ pt.numero }}
                                                </button>
                                            </h2>
                                            <div id="collapseProd_{{ pt.numero }}" class="accordion-collapse collapse">
                                                <div class="accordion-body table-container w-100">
                                                    <table class="table table-bordered table-sm table-striped tabela-produtos" id="tblProd_{{ pt.numero }}">
                                                        <thead class="table-dark">
                                                            <tr>
                                                                <th>#</th>
                                                                <th>C√≥d.</th>
                                                                <th>Descri√ß√£o</th>
                                                                <th>Unidade</th>
                                                                <th>Vl. Compra</th>
                                                                <th>Vl. Un.</th>
                                                                <th>Qtde.</th>
                                                                <th>Tot. Compra</th>
                                                                <th>Vl. Tot.</th>
                                                                <th style="width: 70px;">A√ß√µes</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            {% for pprod in pt.produtos.all %}
                                                            <tr data-porta="{{ pt.numero }}" data-item-id="{{ pprod.produto.id }}">
                                                                <td data-label="#" class="mobile-2col">{{ forloop.counter }}</td>
                                                                <td data-label="C√≥d:" class="mobile-2col">{{ pprod.produto.id }}</td>
                                                                <td data-label="Desc.:" class="mobile-2col">{{ pprod.produto.desc_prod }}</td>
                                                                <td data-label="Unid:" class="mobile-2col">{{ pprod.produto.unidProd }}</td>
                                                                <td class="text-danger fw-bold mobile-3col" data-label="Vl. Compra:">{{ pprod.produto.vl_compra }}</td>
                                                                {% load l10n %}
                                                                <td class="vl-unit text-success fw-bold mobile-3col" data-label="Vl. Unit:">
                                                                    {{ pprod.produto.produtotabela_set.first.vl_prod|unlocalize }}
                                                                </td>
                                                                {% load l10n %}
                                                                <td class="qtd-produto mobile-3col" data-label="Qtde:">
                                                                    {{ pprod.quantidade|unlocalize }}
                                                                </td>
                                                                <td class="tot-compra text-danger fw-bold mobile-3col" data-label="Tot. Compra:">
                                                                    {{ pprod.totCompraP|floatformat:2 }}
                                                                </td>
                                                                <td class="vl-total text-success fw-bold mobile-3col" data-label="Vl. Total:">
                                                                    {{ pprod.subtotalP|floatformat:2 }}
                                                                </td>
                                                                <td data-label="A√ß√µes:" class="mobile-3col">
                                                                    <i class="fas fa-edit editBtn" style="color:#13c43f;cursor:pointer" data-bs-toggle="modal" data-bs-target="#editItemModal"></i>
                                                                    <i class="fas fa-trash deleteBtn" style="color:#db1e47;cursor:pointer"></i>
                                                                </td>
                                                            </tr>
                                                            {% endfor %}
                                                        </tbody>
                                                    </table>
                                                    <!-- üî• Totais da porta -->
                                                    <div class="d-flex justify-content-end gap-4 mt-2 porta-totais" data-porta="{{ pt.numero }}">
                                                        <span>
                                                            <strong>Total Compra:</strong>
                                                            <span style="padding-left: 10px; padding-right: 10px;" class="border border-danger-subtle rounded-4 bg-danger-subtle fw-bold" id="totCompra_porta_{{ pt.numero }}">0,00</span>
                                                        </span>
                                                        <span>
                                                            <strong>Total Venda:</strong>
                                                            <span style="padding-left: 10px; padding-right: 10px;" class="border border-success-subtle rounded-4 bg-success-subtle fw-bold" id="totVenda_porta_{{ pt.numero }}">0,00</span>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                        <!--Adicionais-->
                        <div class="form-section" id="adicionais">
                            <div class="row" style="margin-left: -8px;">
                                <!-- Accordion Adicionais -->
                                <div class="accordion" id="accordionAdicionais">
                                    {% for pt in portas %}
                                        <div class="accordion-item acc-adicional porta-{{ pt.numero }}" id="accAdc_{{ pt.numero }}" data-porta="{{ pt.numero }}">
                                            <h2 class="accordion-header" id="headingAdc_{{ pt.numero }}">
                                                <button class="accordion-button collapsed fw-bold" type="button" data-bs-toggle="collapse" data-bs-target="#collapseAdc_{{ pt.numero }}">
                                                    Adicionais ‚Äì Porta {{ pt.numero }}
                                                </button>
                                            </h2>
                                            <div id="collapseAdc_{{ pt.numero }}" class="accordion-collapse collapse">
                                                <div class="accordion-body table-container w-100">
                                                    <table class="table table-bordered table-sm table-striped tabela-adicionais" id="tblAdc_{{ pt.numero }}">
                                                        <thead class="table-dark">
                                                            <tr>
                                                                <th>#</th>
                                                                <th>C√≥d.</th>
                                                                <th>Descri√ß√£o</th>
                                                                <th>Unidade</th>
                                                                <th>Vl. Compra</th>
                                                                <th>Vl. Un.</th>
                                                                <th>Qtde.</th>
                                                                <th>Tot. Compra</th>
                                                                <th>Vl. Tot.</th>
                                                                <th style="width: 70px;">A√ß√µes</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            {% for adc in pt.adicionais.all %}
                                                            <tr data-porta="{{ pt.numero }}" data-item-id="{{ adc.produto.id }}">
                                                                <td data-label="#" class="mobile-2col">{{ forloop.counter }}</td>
                                                                <td data-label="C√≥d:" class="mobile-2col">{{ adc.produto.id }}</td>
                                                                <td data-label="Desc.:" class="mobile-2col">{{ adc.produto.desc_prod }}</td>
                                                                <td data-label="Unid:" class="mobile-2col">{{ adc.produto.unidProd }}</td>
                                                                <td class="text-danger fw-bold mobile-3col" data-label="Vl. Compra:">{{ adc.produto.vl_compra }}</td>
                                                                {% load l10n %}
                                                                <td class="vl-unit text-success fw-bold mobile-3col" data-label="Vl. Unit:">
                                                                    {{ adc.produto.produtotabela_set.first.vl_prod|unlocalize }}
                                                                </td>
                                                                {% load l10n %}
                                                                <td class="qtd-produto mobile-3col" data-label="Qtde:">
                                                                    {{ adc.quantidade|unlocalize }}
                                                                </td>
                                                                <td class="tot-compra text-danger fw-bold mobile-3col" data-label="Tot. Compra:">
                                                                    {{ adc.totCompraA|floatformat:2 }}
                                                                </td>
                                                                <td class="vl-total text-success fw-bold mobile-3col" data-label="Vl. Total:">
                                                                    {{ adc.subtotalA|floatformat:2 }}
                                                                </td>
                                                                <td data-label="A√ß√µes:" class="mobile-3col">
                                                                    <i class="fas fa-edit editBtn" data-bs-toggle="modal" data-bs-target="#editItemAdcModal" style="color:#13c43f;cursor:pointer"></i>
                                                                    <i class="fas fa-trash deleteBtn" style="color:#db1e47;cursor:pointer"></i>
                                                                </td>
                                                            </tr>
                                                            {% endfor %}
                                                        </tbody>
                                                    </table>
                                                    <!-- üî• Totais da porta -->
                                                    <div class="d-flex justify-content-end gap-4 mt-2 porta-totais" data-porta="{{ pt.numero }}">
                                                        <span>
                                                            <strong>Total Compra:</strong>
                                                            <span style="padding-left: 10px; padding-right: 10px;" class="border border-danger-subtle rounded-4 bg-danger-subtle fw-bold" id="totCompraAdc_porta_{{ pt.numero }}">0,00</span>
                                                        </span>
                                                        <span>
                                                            <strong>Total Venda:</strong>
                                                            <span style="padding-left: 10px; padding-right: 10px;" class="border border-success-subtle rounded-4 bg-success-subtle fw-bold" id="totVendaAdc_porta_{{ pt.numero }}">0,00</span>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                        <!--Form. Pgto.-->
                        <div class="form-section" id="form_pgto">
                            <div class="row" style="margin-left: -8px;">
                                <input type="hidden" id="id_subtotal" name="subtotal">
                                <input type="hidden" id="id_total" name="total">
                                <div class="col-md-2" id="div_id_form_pgto">
                                    {{ form.formas_pgto|as_crispy_field }}
                                </div>
                                <div class="col-md-2" id="div_id_vl_form_pgto">
                                    <label for="id_vl_form_pgto" class="form-label requiredField">Valor*</label>
                                    <input type="text" placeholder="0,00" style="color: #2E8B57; font-weight: bold;" class="form-control border-dark-subtle valor_os" id="id_vl_form_pgto" name="vl_form_pgto">
                                </div>
                                <div class="col-md-1">
                                    <label class="form-label">&nbsp;</label> <!-- Label vazio s√≥ para alinhar -->
                                    <button type="button" class="btn btn-success btn-sm form-control" id="addItemValorFormBtn">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                                <div class="col-md-2" id="div_id_desconto">
                                    <label for="id_desconto" class="form-label">Desconto (-)</label>
                                    <div class="input-group">
                                        <input type="text" step="0.01" placeholder="0,00" min="0.01" class="form-control form-control-sm border-dark-subtle valor_os" readonly="readonly"
                                            id="id_desconto" name="desconto" value="{{ form.desconto.value }}" style="color: #2E8B57; font-weight: bold; background-color: #D3D3D3;">
                                        <button type="button" class="btn btn-outline-secondary btn-sm btn-permissao"
                                            data-permissao="orcamentos.atribuir_desconto" data-acao="atribuir_desconto" id="btnDesconto">
                                            <i class="fa-solid fa-pen-to-square"></i>
                                        </button>
                                    </div>
                                </div>
                                <!--Acr√©scimo-->
                                <div class="col-md-2" id="div_id_acrescimo">
                                    <label for="id_acrescimo" class="form-label">Acr√©scimo (+)</label>
                                    <div class="input-group">
                                        <input type="text" step="0.01" placeholder="0,00" min="0.01"
                                            class="form-control form-control-sm border-dark-subtle valor_os" readonly="readonly" id="id_acrescimo" name="acrescimo" value="{{ form.acrescimo.value }}" style="color: #2E8B57; font-weight: bold; background-color: #D3D3D3;">
                                        <button type="button" class="btn btn-outline-secondary btn-sm btn-permissao"
                                                data-permissao="orcamentos.atribuir_acrescimo" data-acao="atribuir_acrescimo" id="btnAcrescimo">
                                            <i class="fa-solid fa-pen-to-square"></i>
                                        </button>
                                    </div>
                                </div>
                                <div style="overflow-x: auto;">
                                    <table class="table table-bordered table-striped" id="itensTableForm">
                                        <thead class="table-dark">
                                            <tr>
                                                <th col="auto" id="thTableForm" style="text-align: justify;">#</th>
                                                <th col="auto" id="thTableForm" style="text-align: justify;">Forma Pgto.</th>
                                                <th col="auto valor_os" id="thTableForm" style="text-align: justify;">Valor</th>
                                                <th col="auto" style="text-align: justify; width: 40px;">A√ß√µes</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for forma in orcamento.formas_pgto.all %}
                                                <tr>
                                                    <td data-label="#" class="mobile-2col">{{ forloop.counter }}</td>
                                                    <td data-label="Forma Pgto.:" class="mobile-2col">{{ forma.formas_pgto.descricao }}</td>
                                                    <td data-label="Valor:" class="mobile-2col" style="font-weight: bold; color: #2E8B57;">{{ forma.valor|moeda_br }}</td>
                                                    <td data-label="Exc.:" class="mobile-2col">
                                                        <i class="fas fa-trash deleteItemBtn deleteBtn" title="Deletar" style="color: #db1e47;" data-item="{{ produto }}"></i>
                                                    </td>
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                                <ul class="list-group col" style="border-radius: 15px; margin: 10px 5px;">
                                    <li class="list-group-item"><strong>Soma das Formas de Pagamento:</strong> <span style="float: right; padding-left: 10px; padding-right: 10px;" class="border border-secondary rounded-4 bg-primary-subtle fw-bold" id="somaFormas">R$ 0,00</span></li>
                                </ul>
                                <input type="hidden" id="id_json_formas_pgto" name="json_formas_pgto">
                                <div class="col-md-12">
                                    {{ form.obs_form_pgto|as_crispy_field }}
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <ul class="list-group col" style="border-radius: 15px; margin-right: 5px; margin-left: 10px; margin-bottom: 10px;">
                            <li class="list-group-item"><strong>Subtotal:</strong> <span id="subtotal_txt" style="background-color: #3CB371; color: white; font-weight: bold; border-radius: 15px; padding-left: 20px; padding-right: 20px; float: right;">R$ 0.00</span></li>
                            <li class="list-group-item"><strong>Desconto (-):</strong> <span id="desconto" style="background-color: #20B2AA; color: white; font-weight: bold; border-radius: 15px; padding-left: 20px; padding-right: 20px; float: right;">0</span></li>
                            <li class="list-group-item"><strong>Acr√©scimo (+):</strong> <span id="acrescimo" style="background-color: #F08080; color: white; font-weight: bold; border-radius: 15px; padding-left: 20px; padding-right: 20px; float: right;">0</span></li>
                        </ul>
                        <ul class="list-group col" style="border-radius: 15px; margin-right: 5px; margin-left: 10px; margin-bottom: 10px;">
                            <li class="list-group-item"><strong>Custo Total:</strong> <span id="custoTotal_txt" style="background-color: #8B0000; color: white; font-weight: bold; border-radius: 15px; padding-left: 20px; padding-right: 20px; float: right;">R$ 0.00</span></li>
                            <li class="list-group-item"><strong>Total:</strong> <span id="total_txt" style="background-color: #32CD32; color: white; font-weight: bold; border-radius: 15px;  padding-left: 20px; padding-right: 20px; float: right;">R$ 0.00</span></li>
                            <li class="list-group-item"><strong>Margem Lucro:</strong> <span id="margem_txt" style="background-color: #4682B4; color: white; font-weight: bold; border-radius: 15px;  padding-left: 20px; padding-right: 20px; float: right;">0.00%</span></li>
                        </ul>     
                    </div>
                    <div class="card-footer">
                        <div class="base_botao">
                            <button type="button" class="btn btn-success botoes" id="openModalBtn">Alterar</button>
                            <a href="#" class="btn btn-secondary botoes" id="voltarBtn" style="margin-right: 10px;" data-bs-toggle="modal" data-bs-target="#loadingModal">Voltar</a>
                        </div>
                    </div>
                </div>
            {% endif %}
        </form>
    </div>
    <!-- Modal -->
    <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header titulo-modal">
                    <h1 class="modal-title fs-5" id="staticBackdropLabel"><i class="fa-regular fa-circle-question"></i> Confirma√ß√£o!</h1>
                </div>
                <div class="modal-body">
                    <p>Voc√™ confirma a ALTERA√á√ÉO DO OR√áAMENTO?</p>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#loadingModal" id="confirmBtn"><u>S</u>im</button>
                    <button type="button" class="btn btn-secondary" id="btnRecusa" data-bs-dismiss="modal"><u>N</u>√£o</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal de Confirma√ß√£o -->
    <div class="modal fade" id="confirmModal" tabindex="-1" aria-labelledby="confirmModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header titulo-modal">
                    <h5 class="modal-title" id="confirmModalLabel"><i class="fa-solid fa-circle-info"></i> Aten√ß√£o!</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    Voc√™ n√£o tem permiss√£o para realizar esta a√ß√£o. Deseja enviar uma solicita√ß√£o para um usu√°rio autorizado?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">N√£o</button>
                    <button type="button" class="btn btn-primary" id="confirmSend">Sim</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Sele√ß√£o de Usu√°rio -->
    <div class="modal fade" id="userSelectModal" tabindex="-1" aria-labelledby="userSelectModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header titulo-modal">
                    <h5 class="modal-title" id="userSelectModalLabel"><i class="fa-solid fa-user-tie"></i> Selecionar Usu√°rio</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <select id="userSelect" class="form-select">
                        <option selected value="">--------</option>
                        <!-- Options ser√£o preenchidas via AJAX -->
                    </select>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" id="sendNotification"><i class="fa-solid fa-paper-plane"></i> Enviar Notifica√ß√£o</button>
                </div>
            </div>
        </div>
    </div>
    {% comment %} Consulta de Produtos Principais {% endcomment %}
    <div class="modal fade" id="produtoModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="produtoModalLabel" aria-hidden="true">
        <div class="modal-dialog  modal-lg modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header titulo-modal">
                    <h5 class="modal-title" id="produtoModalLabel">Pesquisar Produtos Principais</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="input-group mb-3">
                        <input type="text" id="campo-pesquisa-produto" class="form-control" placeholder="Digite a descri√ß√£o do produto">
                        <button class="btn btn-dark" id="pesquisar-produtos">üîé</button>
                    </div>
                    <div class="table-container mt-3">
                        <table class="table table-bordered table-responsive-md table-rounded table-striped" id="tabelas-lista">
                            <thead class="table-dark">
                                <tr>
                                    <th scope="col">Op√ß√µes</th>
                                    <th scope="col">C√≥digo</th>
                                    <th scope="col">Descri√ß√£o</th>
                                    <th scope="col">Unidade</th>
                                    <th scope="col">Estoque</th>
                                    <th scope="col">Valor</th>
                                </tr>
                            </thead>
                            <tbody id="produtos-lista">
                                <!-- Os produtos ser√£o listados aqui -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                </div>
            </div>
        </div>
    </div>
    {% comment %} Consulta de Produtos Adicionais {% endcomment %}
    <div class="modal fade" id="produtoAdcModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="produtoAdcModalLabel" aria-hidden="true">
        <div class="modal-dialog  modal-lg modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header titulo-modal">
                    <h5 class="modal-title" id="produtoAdcModalLabel">Pesquisar Produtos Adicionais</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="input-group mb-3">
                        <input type="text" id="campo-pesquisa-produto-adicional" class="form-control" placeholder="Digite a descri√ß√£o do produto">
                        <button class="btn btn-dark" id="pesquisar-produtos-adicionais">üîé</button>
                    </div>
                    <div class="table-container mt-3">
                        <table class="table table-bordered table-responsive-md table-rounded table-striped" id="tabelas-lista">
                            <thead class="table-dark">
                                <tr>
                                    <th scope="col">Op√ß√µes</th>
                                    <th scope="col">C√≥digo</th>
                                    <th scope="col">Descri√ß√£o</th>
                                    <th scope="col">Unidade</th>
                                    <th scope="col">Estoque</th>
                                    <th scope="col">Valor</th>
                                </tr>
                            </thead>
                            <tbody id="produtosAdc-lista">
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal de Desconto -->
    <div class="modal fade" id="modalDesconto" tabindex="-1" aria-labelledby="modalDescontoLabel" aria-hidden="true">
        <div class="modal-dialog modal-sm modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-dark text-white">
                    <h1 class="modal-title fs-5" id="modalDescontoLabel">Atribuir Desconto (-)</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="col">
                        <label class="form-label fw-bold" for="tipo_desconto">Tipo de desconto:</label>
                        <select class="form-control" id="tipo_desconto">
                            <option selected value="valor">Valor (R$)</option>
                            <option value="porcentagem">Porcentagem (%)</option>
                        </select>
                    </div>
                    <div class="col">
                        <label class="form-label fw-bold" for="campo_desconto">Valor:</label>
                        <div class="input-group mb-3">
                            <span class="input-group-text" id="simbolo">R$</span>
                            <input class="form-control" id="campo_desconto" value="{{ form.desconto.value }}" type="text" placeholder="0.00" aria-describedby="simbolo">
                        </div>
                    </div>
                    <div class="col">
                        <label class="form-label fw-bold" for="auxiliar_desconto">Percentual:</label>
                        <div class="input-group mb-3">
                            <span class="input-group-text" id="simboloAuxiliar">%</span>
                            <input class="form-control" id="auxiliar_desconto" disabled="disabled" type="text" placeholder="0.00" aria-describedby="simboloAuxiliar">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                    <button type="button" class="btn btn-primary" id="confirmarDesconto">Atribuir</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal -->
    <div class="modal fade" id="modalAcrescimo" tabindex="-1" aria-labelledby="modalAcrescimoLabel" aria-hidden="true">
        <div class="modal-dialog modal-sm modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-dark text-white">
                    <h1 class="modal-title fs-5" id="modalAcrescimoLabel">Atribuir Acr√©scimo (+)</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="col">
                        <label class="form-label fw-bold" for="tipo_acrescimo">Tipo de Acr√©scimo:</label>
                        <select class="form-control" id="tipo_acrescimo">
                            <option selected value="valor">Valor (R$)</option>
                            <option value="porcentagem">Porcentagem (%)</option>
                        </select>
                    </div>
                    <div class="col">
                        <label class="form-label fw-bold" for="campo_acrescimo">Valor:</label>
                        <div class="input-group mb-3">
                            <span class="input-group-text" id="simboloAc">R$</span>
                            <input class="form-control" id="campo_acrescimo" type="text" placeholder="0.00" aria-describedby="simboloAc" value="{{ form.acrescimo.value }}">
                        </div>
                    </div>
                    <div class="col">
                        <label class="form-label fw-bold" for="auxiliar_acrescimo">Percentual:</label>
                        <div class="input-group mb-3">
                            <span class="input-group-text" id="simboloAuxiliarAc">%</span>
                            <input class="form-control" id="auxiliar_acrescimo" disabled="disabled" type="text" placeholder="0.00" aria-describedby="simboloAuxiliarAc">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                    <button type="button" class="btn btn-primary" id="confirmarAcrescimo">Atribuir</button>
                </div>
            </div>
        </div>
    </div>
    <!--Modal de Produtos Principais-->
    <div class="modal fade" id="editItemModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <form>
                    <div class="modal-header" style="background-color: #191919; color: white;">
                        <h5 class="modal-title"></h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="row g-3">
                            <div class="col-md-2">
                                <label for="editC√≥dInput" class="form-label requiredField">C√≥digo</label>
                                <input type="text" class="form-control" id="editC√≥dInput" name="editC√≥d" disabled="disabled">
                            </div>
                            <div class="col-md-8">
                                <label for="editDescInput" class="form-label requiredField">Descri√ß√£o</label>
                                <input type="text" class="form-control" id="editDescInput" name="editDesc">
                            </div>
                            <div class="col-md-2">
                                <label for="editUnidInput" class="form-label requiredField">Unidade</label>
                                <input type="text" class="form-control" id="editUnidInput" name="editUnid">
                            </div>
                        </div>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <input type="hidden" class="form-control" id="editValorCompraItemInput" name="editValorCompraItem">
                                <label for="editValorItemInput" class="form-label requiredField valor_os">Valor</label>
                                <input type="text" class="form-control" id="editValorItemInput" name="editValorItem">
                            </div>
                            <div class="col-md-6 btn-toolbar" role="toolbar" aria-label="Toolbar Produto">
                                <label for="editQtdInput" class="form-label requiredField">Quantidade</label>
                                <div class="input-group input-group-sm flex-md-fill">
                                    <button type="button" class="btn btn-info tbn-sm remQtd"><i class="fa-solid fa-minus"></i></button>
                                    <input type="text" class="form-control form-control-sm" id="editQtdInput" name="editQtd">
                                    <button type="button" class="btn btn-info tbn-sm addQtd"><i class="fa-solid fa-plus"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-dark" data-bs-dismiss="modal" id="saveEditBtn">Salvar</button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" id="fechar-modal">Fechar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <!--Modal de Produtos Adicionais-->
    <div class="modal fade" id="editItemAdcModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <form>
                    <div class="modal-header" style="background-color: #191919; color: white;">
                        <h5 class="modal-title"></h5>
                    </div>
                    <div class="modal-body">
                        <div class="row g-3">
                            <div class="col-md-2">
                                <label for="editC√≥dAdcInput" class="form-label requiredField">C√≥digo</label>
                                <input type="text" class="form-control" id="editC√≥dAdcInput" name="editC√≥dAdc" disabled="disabled">
                            </div>
                            <div class="col-md-8">
                                <label for="editDescAdcInput" class="form-label requiredField">Descri√ß√£o</label>
                                <input type="text" class="form-control" id="editDescAdcInput" name="editDescAdc">
                            </div>
                            <div class="col-md-2">
                                <label for="editUnidAdcInput" class="form-label requiredField">Unidade</label>
                                <input type="text" class="form-control" id="editUnidAdcInput" name="editUnidAdc">
                            </div>
                        </div>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <input type="hidden" class="form-control" id="editValorCompraItemAdcInput" name="editValorCompraItemAdc">
                                <label for="editValorItemAdcInput" class="form-label requiredField valor_os">Valor</label>
                                <input type="text" class="form-control" id="editValorItemAdcInput" name="editValorItemAdc">
                            </div>
                            <div class="col-md-6 btn-toolbar" role="toolbar" aria-label="Toolbar de Adicionais">
                                <label for="editQtdAdcInput" class="form-label requiredField">Quantidade</label>
                                <div class="input-group input-group-sm flex-md-fill">
                                    <button type="button" class="btn btn-info tbn-sm remQtdAdc"><i class="fa-solid fa-minus"></i></button>
                                    <input type="text" class="form-control form-control-sm" id="editQtdAdcInput" name="editQtdAdc">
                                    <button type="button" class="btn btn-info tbn-sm addQtdAdc"><i class="fa-solid fa-plus"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-dark" data-bs-dismiss="modal" id="saveEditAdcBtn">Salvar</button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    {% comment %} <div class="col-md-2" id="div_id_cod_prod">
        <label for="id_cod_prod" class="form-label requiredField">C√≥d.</label>
        <div class="input-group">
            <input type="text" id="id_cod_prod" class="form-control form-control-sm border-dark-subtle" placeholder="C√≥d. Prod." aria-label="C√≥d. Prod." aria-describedby="button-addon2">
            <button class="btn btn-outline-dark btn-sm" type="button" id="button-addon2">üîé</button>
        </div>
    </div>
    <div class="col-md-3" id="div_id_desc_prod">
        <label for="id_desc_prod" class="form-label requiredField">Descri√ß√£o</label>
        <input type="text" class="form-control form-control-sm border-dark-subtle" id="id_desc_prod" name="desc_prod" disabled="disabled">
    </div>
    <div class="col-md-2" id="div_id_unid_prod">
        <label for="id_unidProd" class="form-label requiredField">Unidade</label>
        <input type="text" class="form-control form-control-sm border-dark-subtle" id="id_unidProduto" name="unid_prod" disabled="disabled">
    </div>
    <div class="col-md-1" id="div_id_vl_prod">
        <label for="id_vl_prod" class="form-label requiredField">Valor*</label>
        <input type="text" style="color: #2E8B57; font-weight: bold;" class="form-control form-control-sm border-dark-subtle valor_os" placeholder="0.00" id="id_vl_prod" name="vl_prod">
    </div>
    <div class="col-md-1" id="div_id_qtd_prod">
        <label for="id_qtd_prod" class="form-label requiredField">Qtde.*</label>
        <input type="text" class="form-control form-control-sm border-dark-subtle" placeholder="0.00" id="id_qtd_prod" name="qtd_prod">
    </div>
    <div class="col-md-1 d-flex align-items-end">
        <button type="button" class="btn btn-success btn-sm" id="addItemProdBtn"><i class="fas fa-plus"></i></button>
    </div>
    <div class="col-md-1" id="div_id_vl_compra">
        <input type="hidden" style="color: #DC143C; font-weight: bold;" class="form-control form-control-sm border-dark-subtle valor_os" id="id_vl_compra" name="vl_compra" disabled="disabled">
    </div> {% endcomment %}
    {% comment %} <div class="col-md-2" id="div_id_cod_prod_adc">
        <label for="id_cod_prod_adc" class="form-label requiredField">C√≥d.</label>
        <div class="input-group">
            <input type="text" id="id_cod_prod_adc" class="form-control form-control-sm border-dark-subtle" placeholder="C√≥d. Prod." aria-label="C√≥d. Prod. Adicional" aria-describedby="button-addon3">
            <button class="btn btn-outline-dark btn-sm" type="button" id="button-addon3">üîé</button>
        </div>
    </div>
    <div class="col-md-3" id="div_id_desc_prod_adc">
        <label for="id_desc_prod_adc" class="form-label requiredField">Descri√ß√£o</label>
        <input type="text" class="form-control form-control-sm border-dark-subtle" id="id_desc_prod_adc" name="desc_prod_adc" disabled="disabled">
    </div>
    <div class="col-md-2" id="div_id_unidProd_adc">
        <label for="id_unidProd_adc" class="form-label requiredField">Unidade</label>
        <input type="text" class="form-control form-control-sm border-dark-subtle" id="id_unidProd_adc" name="unidProd_adc" disabled="disabled">
    </div>
    <div class="col-md-1" id="div_id_vl_prod_adc">
        <label for="id_vl_prod_adc" class="form-label requiredField">Valor*</label>
        <input type="text" style="color: #2E8B57; font-weight: bold;" class="form-control form-control-sm border-dark-subtle valor_os" placeholder="0.00" id="id_vl_prod_adc" name="vl_prod_adc">
    </div>
    <div class="col-md-1" id="div_id_qtd_prod_adc">
        <label for="id_qtd_prod_adc" class="form-label requiredField">Qtde.*</label>
        <input type="text" class="form-control form-control-sm border-dark-subtle" placeholder="0.00" id="id_qtd_prod_adc" name="qtd_prod_adc">
    </div>
    <div class="col-md-1 d-flex align-items-end">
        <button type="button" class="btn btn-success btn-sm" id="addItemProdAdcBtn"><i class="fas fa-plus"></i></button>
    </div>
    <div class="col-md-1" id="div_id_vl_compra_adc">
        <input type="hidden" style="color: #DC143C; font-weight: bold;" class="form-control form-control-sm border-dark-subtle valor_os" id="id_vl_compra_adc" name="vl_compra_adc" disabled="disabled">
    </div> {% endcomment %}
</div>
{% endblock %}